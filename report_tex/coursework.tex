\documentclass[a4paper,14pt]{extarticle}
\usepackage{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{fancyhdr}
\usepackage{setspace}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{tikz}
\usepackage{pgf}
\usepackage{subcaption}
\usepackage{listings}
\usepackage[colorlinks, linkcolor=blue, urlcolor=blue]{hyperref}
\usepackage{indentfirst}
\graphicspath{{images/}}%путь к рисункам
%\usepackage{mathptmx}

\makeatletter
\renewcommand{\@biblabel}[1]{#1.} % Заменяем библиографию с квадратных скобок на точку:
\makeatother

\geometry{left=2.5cm}% левое поле
\geometry{right=1.5cm}% правое поле
\geometry{top=1.5cm}% верхнее поле
\geometry{bottom=1.5cm}% нижнее поле
\renewcommand{\baselinestretch}{1.5} % междустрочный интервал

\newcommand{\bibref}[3]{\hyperlink{#1}{#2 (#3)}} % biblabel, authors, year

\renewcommand{\theenumi}{\arabic{enumi}}% Меняем везде перечисления на цифра.цифра
\renewcommand{\labelenumi}{\arabic{enumi}}% Меняем везде перечисления на цифра.цифра
\renewcommand{\theenumii}{.\arabic{enumii}}% Меняем везде перечисления на цифра.цифра
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}.}% Меняем везде перечисления на цифра.цифра
\renewcommand{\theenumiii}{.\arabic{enumiii}}% Меняем везде перечисления на цифра.цифра
\renewcommand{\labelenumiii}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.}% Меняем везде перечисления на цифра.цифра

\newcommand{\imgh}[3]{\begin{figure}[h]
                          \center{\includegraphics[width=#1]{#2}}

                          \caption{#3}\label{ris:#2}
\end{figure}}

\begin{document}
    \input{title.tex}% это титульный лист
    \newpage

    {
    \hypersetup{linkcolor=black}
    \tableofcontents
    }

    \newpage

    \begin{abstract}
        При проведении антропологических исследований часто необходимо обработать данные внушительных объемов. Существует вариант обработать все эти данные вручную, однако такой метод слишком затратен по времени и трудовым ресурсам. В нашей проектной работе мы решаем задачу автоматизации обработки изображений. Наша задача заключается в классификации гендерных и возрастных групп людей. В процессе решения возникли несколько подзадач. Первая - выделение лица на фотографии. Вторая - проверка того, что выделенное на фотографии лицо принадлежит живому человеку, а не напечатано на рекламном щите или является скульптурой. Решение этой задачи позволяет уменьшить шум в данных и повысить точность статистик возрастных и гендерных групп, вычисляемых по фотографиям. В своём решении мы комбинируем различные известные подходы для достижения наилучшего результата.
        \\
        \small \textbf{\textit{Ключевые слова---}}Определение возраста и пола, Распознавание лиц, Глубокое обучение, Антропология \\

        When conducting anthropological studies, it is often necessary to process a large amount of data. There is an option to process all this data manually, but this method is too time-consuming and labor-intensive. In our project, we solve two problems of data processing automation. The first is to verify that the face highlighted in the photo belongs to a living person, and is not printed on a banner or is a sculpture. The solution to this problem allows us to reduce noise in the data and improve the accuracy of gender and age groups statistics calculated from photographs. The second is the classification of sights in the photograph. The solution to this problem, in turn, allows you to automate the calculation of statistics on the popularity of public places. In our solutions we use convolutional neural networks of various architectures.
        \\
        \small \textbf{\textit{Keywords---}}Face Recognition, Deep Learning, Anthropology
        \\
        \newpage
    \end{abstract}

    \section{Введение}

    На сегодняшний день человечество владеет огромными объемами данных, и во многих сферах деятельности приходится каким-либо образом с ними взаимодействовать. Одной из таких сфер является антропология. Для изучения человеческого развития и культуры необходимо наблюдать за человеком и анализировать его поступки и предпочтения. Одной из задач антропологов является облагораживание города. Для ее выполнения им нужно знать, где горожанам не хватает детской площадки или парка, где требуется произвести ремонт или реконструкцию здания. Хорошим источником информации о людях являются фотографии жителей какого-либо населенного пункта, ведь из них можно узнать, какие достопримечательности или объекты архитектуры наиболее привлекают людей, к каким возрастным и гендерным группам относятся эти люди, а также еще много другой важной для антропологии статистики. Конечно, никто не хочет тратить свое время и силы на просмотр тысяч фотографий и выделение из них полезных данных, гораздо удобнее и выгоднее автоматизировать этот рутинный процесс там, где это возможно.
    Все известные подходы к классификации гендерных и возрастных групп людей по фотографии заключаются в анализе изображения лица. Самые ранние основывались на различиях в размерах лиц, или использовали
    Существует довольно много известных методов выделения лиц на фотографиях. Однако, такие подходы выделяют также лица памятников и лица, напечатанные на рекламных щитах и вывесках. В нашей работе мы хотим отсеивать такие ошибки. Таким образом, первая задача нашего проекта - получение алгоритма, способного отличить “живое” лицо от “неживого”.

    В ходе выполнения работы мы не будем предлагать каких-либо новых методов, однако мы используем ряд различных уже существующих технологий машинного обучения, которые могут быть применимы в решении самых разных задач. В итоге мы получим алгоритм, способный перебирать большие объемы фотографий, находить на них нужные объекты и собирать важные статистики для помощи в проведении исследований.
    \newpage

    \section{Обзор литературы}
    На данный момент в области компьютерного зрения применяются сверточные нейросети большой глубины, например \bibref{resnet}{ResNet}{2015} и \bibref{densenet}{DenseNet}{2016}. Архитектуры этих нейросетей позволяют выучивать сложные закономерности в данных и использовать их для дальнейшего анализа. Так как к нашей задаче существует много проверенных подходов, мы можем позаимствовать некоторые из них. В частности в статье \bibref{pfid}{Primate Face Identification in the Wild}{2019} была описана идея модификации архитектур нейросетей и построения функции ошибки. На основе статьи \bibref{face}{Deep Face Recognition: A Survey}{2018} была построена модель принятия решения по конкретному лицу и модель обучения нейросети. Так же на основе статьи \bibref{align}{One Millisecond Face Alignment with an Ensemble of Regression Trees}{2014} была построена модель для выравнивания лиц.

    \section{Распознавание лиц}
    ЖОПАААААААА

    \section{Отличие "живого" \, лица от напечатанного}
    Эта часть сделана Александром Шабалиным.\\
    Задача определения является ли лицо на фотографии напечатанным или реальным довольно популярна, так как используется в Face Anti-Spoofing системах, предназначенных для обнаружения попытки взлома при прохождении биометрической идентификации. Однако чаще всего при распознавании используется видео или инфракрасное изображение. В нашем случае мы владеем только фотографией объекта, что сильно усложняет задачу, ведь мы не можем, например, улавливать моргания или пульс, что позволит нам определить, является ли человек живым, как в случае с видео.
    После проведения исследований, было решено использовать LBP (Local binary patterns - Локальные бинарные шаблоны), трансформировав изображение из RGB в YCbCr (яркость, синяя и красная цветоразностные компоненты). Сущность LBP метода заключается в построении вектора чисел. В простейшим варианте это делается следующим образом: для каждого пикселя берутся n соседних пикселей. Затем обходим их все по кругу. Для каждого пикселя сравниваем его значение с центральным, если значение больше, то ставим 1, иначе - 0. Получаем n-битное двоичное число. Проделав такую операцию со всеми пикселями, построим гистограмму распределения чисел. Сконкотенируем гистограммы для всех 3-х цветовых каналов и получим искомый вектор. Трансформировав таким образом все картинки, мы получим новый датасет, на котором обучим метод опорных векторов с полиномиальным ядром.
    Интуиция данного метода заключается в том, что живое человеческое лицо отражает свет неравномерно, в отличие от бумажной фотографии. Поэтому средний вектор живого лица будет отличаться от вектора напечатанного. Важно заметить, что мы будем считать только те числа, у которых в двоичной записи идут сначала единицы, а потом нули. Также будем считать их инвариантными к повороту.
    Такой метод действительно оказался рабочим. На датасете NUAA Photograph Imposter Database удалось получить точность классификации 99.8\%, что является отличным показателем. Также данный алгоритм работает гораздо быстрее нейросетей и результат не зависит от поворота или смещения лица на картинке. Однако фотографии в датасете отличаются от фотографий, на которых предстоит использовать алгоритм. Выяснилось, что на реальных изображениях результаты гораздо хуже - точность около 70\%, что нас совершенно не устраивает. Причина такого падения качества скорее всего заключается в качестве фотографий (В датасете NUAA Photograph Imposter Database фотографии больше и их разрешение выше). Так как данное решение оказалось неподходящим для поставленной задачи, от него пришлось отказаться и перейти к использованию нейронных сетей.

    \section{Отличие "живого" \, лица от скульптуры}
    Эта часть сделана Алексеем Биршертом. \\

    \subsection{Описание метода}
    Для принятия решения по конкретному изображению лица является ли оно человеческим или принадлежит скульптуре в своей работе я использую сверточные нейросети. В качестве основных изучаемых нейросетей я выбрал три архитектуры - ResNet-18, Densenet-121 и Densenet-201. В каждой модели был убран первый слой maxpool и последний полносвязный слой заменён на слой с двумя выходными нейронами. TODO дописать номально.

    \subsection{Подготовка данных}
    Во время работы я столкнулся с проблемой недостаточного количества данных в классе памятников - поиск баз данных с фотографиями скульптур людей в открытом доступе не дал положительных результатов. Было принято решение выкачать фотографии из тематических групп в социальной сети Вконтакте посвященных скульптуре и живописи. Таким образом набралось около 7000 различных фотографий скульптур и бюстов. В качестве датасетов с фотографиями людей было решено взять датасет Labeled Faces in the Wild - в нём было около 13 тысяч фотографий различных людей и датасет IMDB-WIKI, в нём было более 500 тысяч фотографий людей. Из каждого датасета я случайно отобрал по 10 тысяч фотографий для дальнейшей обработки. \\
    Для выделения лиц из фотографий использовался детектор лиц на основе сверточной сети и модель для предсказания точек на лице на основе ансамбля решающих деревьев из библиотеки dlib. Для обучения последней был использован датасет iBug 300-W. \\
    После выделения области с лицом с помощью детектора я находил положение 12 ключевых для меня точек на лице с помощью \bibref{align}{модели}{2014} - по 6 на каждый глаз. После я производил выравнивание лица, чтобы прямая проведенная через центры глаз была горизонтальна и левый глаз находился на определенном расстоянии от края фотографии, для баланса размера лиц. После полученное изображение сохранялось на диск для дальнейшего использования. После обработки всех фотографий и ручной очистки данных от мусора было получено следующее количество образцов классов - около 2000 памятников и скульптур и чуть больше 20000 людей.

    \subsection{Обучение моделей}
    В своей работе я обучил три нейросети для бинарной классификации памятников и людей и одну модель на основе ансамбля решающих деревьев для предсказания положения глаз на фотографии.
    Для обучения нейросетей были использованы обработанные и обрезанные ранее фотографии людей и памятников. Для увеличения обучающей выборки я использовал аугментацию по типу one-to-many, с помощью различных преобразований получающих новые объекты. В качестве преобразования каждый раз выбиралось одно из 4 следующих: случайное изменение яркости, контраста, насыщенности и оттенка картинки, случайное афинное преобразование, случайное отражение вдоль вертикальной оси, проходящей через центр картинки, либо случайное преобразование в Grayscale. Потом все изображения приводились к размеру 100 на 100 пикселей и нормировались.
    Каждая нейросеть обучалась 64 эпохи с размером батча в 64 картинки и темпом обучения 1e-4 с постепенным уменьшением коэффициента в 10 раз каждые 16 эпох.
    Модель для предсказания точек на лице обучалась с помощью втроенной в библиотеку dlib функции с параметрами по умолчанию.

    \subsection{Обработка результатов}
    В моем распоряжении имелся датасет с реальными данными, с которыми предстояло работать. Это были размеченные вручную фотографии людей. Таким образом я мог оценить точность своих алгоритмов в условиях поставленной задачи. TODO таблица + посчитать точность везде нормально + влияние выравнивания.

    \subsection{Выводы}
    Таким образом была решена задача бла бла бла с хорошим качеством. TODO

    \section{Классификация гендерных и возрастных групп}
    ЖОПППАААА 2
    \newpage

    \section{Список литературы}
    \renewcommand{\section}[2]{}
    \begin{thebibliography}{0}
        \bibitem{lbp}\hypertarget{lpb}{}
        \href{https://arxiv.org/abs/1511.06316}
        {Zinelabidine Boulkenafet, Jukka Komulainen, Abdenour Hadid. Face Anti-Spoofing Based on Color Texture Analysis. 2015}
        \bibitem{resnet}\hypertarget{resnet}{}
        \href{https://arxiv.org/abs/1512.03385}
        {Kaiming He, Xiangyu Zhang, Shaoqing Ren, Jian Sun. Deep Residual Learning for Image Recognition. 2015}
        \bibitem{densenet}\hypertarget{densenet}{}
        \href{https://arxiv.org/abs/1608.06993}
        {Gao Huang, Zhuang Liu, Laurens van der Maaten, Kilian Q. Weinberger. Densely Connected Convolutional Networks. 2016}
        \bibitem{pfid}\hypertarget{pfid}{}
        \href{https://arxiv.org/abs/1907.02642}
        {Ankita Shukla, Gullal Singh Cheema, Saket Anand, Qamar Qureshi, Yadvendradev Jhala. Primate Face Identification in the Wild. In PRICAI 2019}
        \bibitem{face}\hypertarget{face}{}
        \href{https://arxiv.org/abs/1804.06655}
        {Mei Wang, Weihong Deng. Deep Face Recognition: A Survey. 2018}
        \bibitem{align}\hypertarget{align}{}
        \href{http://www.csc.kth.se/~vahidk/papers/KazemiCVPR14.pdf}
        {Vahid Kazemi and Josephine Sullivan. One Millisecond Face Alignment with an Ensemble of Regression Trees. 2014}
    \end{thebibliography}
\end{document}
